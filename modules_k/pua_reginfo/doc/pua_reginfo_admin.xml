<?xml version="1.0" encoding='ISO-8859-1'?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
"http://www.oasis-open.org/docbook/xml/4.4/docbookx.dtd" [

<!-- Include general documentation entities -->
<!ENTITY % docentities SYSTEM "../../../docbook/entities.xml">
%docentities;

]>
<!-- Module User's Guide -->

<chapter>
	

	<title>&adminguide;</title>
	
	<section>
	  <title>Overview</title>
	    <para> 
	      This modules publishes information about "reg"-events according to
              to RFC 3680. This can be used distribute the registration-info
              status to the subscribed watchers.
	    </para>
	    <para>
 	      This module "PUBLISH"es information when a new user registers
              at this server (e.g. when "save()" is called) to users, which have
              subscribed for the reg-info for this user.
	    </para>
	    <para>
 	      This module can "SUBSCRIBE" for information at another server, so it
              will receive "NOTIFY"-requests, when the information about a user
              changes.
	    </para>
	    <para>
 	      And finally, it can process received "NOTIFY" requests and it will 
              update the local registry accordingly.
	    </para>
	</section>

	<section>
	  <title>Dependencies</title>
	  <section>
		<title>&kamailio; Modules</title>
		<para>
		The following modules must be loaded before this module:
			<itemizedlist>
			<listitem>
			<para>
				<emphasis>pua</emphasis>.
			</para>
			</listitem>
			<listitem>
			<para>
				<emphasis>usrloc</emphasis>.
			</para>
			</listitem>
			</itemizedlist>
		</para>
	  </section>

	  <section>
		<title>External Libraries or Applications</title>
		<para>
		None.
		</para>
	  </section>
	</section>

	<section>
		<title>Exported Functions</title>
		<section>
			<title>
				<function moreinfo="none">reginfo_handle_notify</function>
			</title>
			<para>
				This function processes received "NOTIFY"-requests and updates
				the local registry accordingly.
			</para>
			<example>
				<title><function>reginfo_handle_notify</function> usage</title>
				<programlisting format="linespecific">
...
if(is_method("NOTIFY")) 
	reginfo_handle_notify();		
...
				</programlisting>
			</example>
		</section>
		<section>
			<title>
				<function moreinfo="none">reginfo_subscribe(uri)</function>
			</title>
			<para>
				This function will subscribe for reginfo-information at the given
				server URI.
			</para>
			<para>Meaning of the parameters is as follows:</para>
			<itemizedlist>
			<listitem>
				<para>
				<emphasis>uri</emphasis> - SIP-URI of the server, where to subscribe,
				may contain pseudo-variables.
				</para>
			</listitem>
			</itemizedlist>
			<example>
				<title><function>reginfo_subscribe</function> usage</title>
				<programlisting format="linespecific">
...
route {
	t_on_reply("1");
	t_relay();
}

reply_route[1] {
	if (t_check_status("200")) 
		reginfo_subscribe("$ru");		
}
...
				</programlisting>
			</example>
		</section>
	</section>

</chapter>
